library(tidyverse)

df_ret_demo <- read.csv("tu_archivo_ret_demo.csv")

df_ret_long <- df_ret_demo %>%
  pivot_longer(
    cols = c("d1_retention", "d3_retention", "d7_retention"),
    names_to = "retention_type", 
    values_to = "percentage"    
  ) %>%
  filter(!is.na(percentage)) 


if (nrow(df_ret_long) > 0) {
    
      ggplot(data = df_ret_long, aes(x = country, y = percentage, fill = retention_type)) +
        
        geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
        
       
        geom_text(
          aes(label = round(percentage, 1)), 
          # 'position_dodge' alinea el texto con su barra correspondiente
          position = position_dodge(width = 0.9), 
          vjust = -0.5, # Ajusta la posición vertical del texto
          size = 3
        ) +
        
       
        labs(
            title = "Retention (D1, D3, D7) by Country",
            x = "Country",
            y = "Retention Percentage (%)",
            fill = "Retention Type" # Título para la leyenda
        ) +
        
	theme_minimal() +    
        theme(
            axis.text.x = element_text(
                angle = 45,
                hjust = 1,
                vjust = 1
            )
        )
    
} 
else
{
    print("Data frame is empty")
}