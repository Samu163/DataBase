
library(tidyverse)

df_ret <- read.csv("tu_archivo.csv")

df_ret_long <- df_ret %>%
  pivot_longer(
    cols = c("d1_percentage", "d3_percentage", "d7_percentage"),
    names_to = "retention_type", # Nueva columna para "D1", "D3", "D7"
    values_to = "percentage"     # Nueva columna para los valores
  ) %>%
  filter(!is.na(percentage)) # Elimina filas donde el porcentaje es NA

df_avg <- df_ret_long %>%
  group_by(retention_type) %>%
  summarise(average_percentage = mean(percentage, na.rm = TRUE))


if (nrow(df_avg) > 0) {
    
    ggplot(data = df_avg, aes(x = reorder(retention_type, -average_percentage), 
                               y = average_percentage, 
                               fill = retention_type)) +
        
        #Bars
        geom_bar(stat = "identity") +        
        geom_text(
          aes(label = paste0(round(average_percentage, 1), "%")), 
          vjust = -0.5 # Ajusta la posici√≥n vertical del texto
        ) +
        
        labs(
            title = "Overall Average Retention (D1, D3, D7)",
            x = "Retention Type",
            y = "Average Percentage (%)"
        ) +
        
        theme_minimal() +
        theme(legend.position = "none")
    
} 
else 
{
    print("Data frame is empty")
}